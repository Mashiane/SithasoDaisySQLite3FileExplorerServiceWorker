
/* sqlite3x */
importScripts('bananocorebw.js');importScripts('sql-browser.min.js');function banano_sithasodaisysqlite3filebrowsersw_sqlite3x() {var _B=this;_B._tablenames=[];_B._assetfile="";_B._dbsql=null;_B._task_open_database="open_database";_B._task_select_all="select_all";_B._task_table_names="table_names";_B._task_table_schema="table_schema";_B._task_table_columns="table_columns";_B._task_index_list="index_list";_B._task_foreign_key_list="foreign_key_list";_B._task_index_info="index_info";_B._task_count="count";_B._task_sum="sum";_B._stablename="";_B._result=[];_B._rowcount=0;_B._wherefield={};_B._ops=[];_B._orderbyl=[];_B._flds=[];_B._lastposition=0;_B._record={};_B._schema={};_B._primarykey="";_B._displayfield="";_B._singular="";_B._plural="";_B._displayvalue="";_B._combinel=[];_B._showlog=false;_B._operations=[];_B._types=[];_B._args=[];_B._db_bool="BOOL";_B._db_int="INT";_B._db_string="STRING";_B._db_real="REAL";_B._db_blob="BLOB";_B._db_float="FLOAT";_B._db_integer="INTEGER";_B._db_text="TEXT";_B._db_double="DOUBLE";_B.initialize=function() {;};_B.banano_stopbackgroundworker=function() {};_B.postmessage=function(_tag,_args1) {_BB.postMessage({'tag': _tag, 'value': _args1, 'error': null});};_B.settablename=function(_s) {_B._stablename=_s;};_B.gettablename=function() {return _B._stablename;};_B.reset=function() {_B._result.length=0;_B._rowcount=0;_B._wherefield={};_B._ops.length=0;_B._orderbyl.length=0;_B._flds.length=0;_B._record={};_B._lastposition=-1;_B._primarykey="id";_B._schema={};_B._combinel.length=0;_B._showlog=false;_B._types.length=0;_B._args.length=0;};_B.opendatabase=function(_filename) {var _buffer,_ldbsql,_fe,_error,_pfe,_error1,_prom,_uint8array;_B._assetfile=_filename;_B.reset(_B);_buffer={};_ldbsql=null;_fe=false;_error={};_pfe=_B.fileexist(_B._assetfile,_B);_pfe.then(function(_fe) {switch ("" + _fe) {case "" + true:_error1={};_prom=BANFetch('A', _B._assetfile,'');_prom.then(function(_buffer) {_uint8array=null;_uint8array=new Uint8Array(_buffer);_ldbsql=new SQL.Database(_uint8array);_B._dbsql=_ldbsql;_B.postmessage("READY",null,_B);}).catch(function(_error1) {_B.raiseerror(_B._task_open_database,_error1,_B);});break;case "" + false:_B.raiseerror(_B._task_open_database,"File not found.",_B);break;}}).catch(function(_error) {_B.raiseerror(_B._task_open_database,_error,_B);});};_B.select_tables=function() {var _stmt,_stable_name;_B._tablenames.length=0;_B.settablename("sqlite_master",_B);_stmt="SELECT name AS table_name FROM sqlite_master WHERE type = 'table' AND name NOT LIKE 'sqlite_%';";_B.execqueryresult(_stmt,_B);while (_B.nextrow(_B)) {_stable_name=_B.getstring("table_name",_B);_B._tablenames.push(_stable_name);}_B.raisesuccess(_B._task_table_names,_B._tablenames,_B);};_B.raisesuccess=function(_task,_data) {var _client;_client={};_client["data"]=_data;_client["task"]=_task;_BB.postMessage({'tag': "SUCCESS", 'value': _client, 'error': null});};_B.table_schema=function(_tblname) {var _query;_B.settablename(_tblname,_B);_query="PRAGMA table_info('" + _tblname + "')";_B.execqueryresult(_query,_B);_B.raisesuccess(_B._task_table_schema,_B._result,_B);};_B.table_columns=function(_tblname) {var _query,_columns,_stable_name;_B.settablename(_tblname,_B);_query="PRAGMA table_info('" + _tblname + "')";_B.execqueryresult(_query,_B);_columns=[];_columns.length=0;while (_B.nextrow(_B)) {_stable_name=_B.getstring("name",_B);_columns.push(_stable_name);}_B.raisesuccess(_B._task_table_columns,_columns,_B);};_B.table_index_list=function(_tblname) {var _query;_B.settablename(_tblname,_B);_query="PRAGMA index_list('" + _tblname + "')";_B.execqueryresult(_query,_B);_B.raisesuccess(_B._task_index_list,_B._result,_B);};_B.table_index_info=function(_idxname) {var _query;_query="PRAGMA index_info('" + _idxname + "')";_B.execqueryresult(_query,_B);_B.raisesuccess(_B._task_index_info,_B._result,_B);};_B.table_foreign_key_list=function(_tblname) {var _query;_B.settablename(_tblname,_B);_query="PRAGMA foreign_key_list('" + _tblname + "')";_B.execqueryresult(_query,_B);_B.raisesuccess(_B._task_foreign_key_list,_B._result,_B);};_B.table_count=function(_tblname) {var _query;_B.settablename(_tblname,_B);_query="select count(*) as records from `" + _tblname + "`";_B.execqueryresult(_query,_B);_B.raisesuccess(_B._task_count,_B._result,_B);};_B.table_sum=function(_tblname,_fldname) {var _query;_B.settablename(_tblname,_B);_query="select sum(" + _fldname + ") as " + _fldname + " from " + _tblname + "";_B.execqueryresult(_query,_B);_B.raisesuccess(_B._task_sum,_B._result,_B);};_B.select_all=function(_tblname) {var _fld1,_selfields,_sb,_stro,_stmt;_B.settablename(_tblname,_B);try {if (_B._flds.length==0) {_B._flds.push("*");}_fld1=_B._flds[0];_selfields="";switch ("" + _fld1) {case "" + "*":_selfields="*";break;default:_selfields=_B.join(",",_B._flds,_B);break;}_sb=new StringBuilder();_sb.init();_sb.isinitialized=true;_sb.append("SELECT " + _selfields + " FROM `" + _B._stablename + "`");if (true && _B._orderbyl.length>0) {_stro=_B.join(",",_B._orderbyl,_B);if (_stro.length>0) {_sb.append(" ORDER BY ").append(_stro);}}_stmt=_sb.toString();_B.execqueryresult(_stmt,_B);_B.raisesuccess(_B._task_select_all,_B._result,_B);} catch(err) {_B.raiseerror(_B._task_select_all,err.message,_B);}};_B.join=function(_delimiter,_lst) {var _i,_sbx,_fld;if (_lst.length==0) { return "";}_i=0;_sbx=new StringBuilder();_fld="";_sbx.init();_sbx.isinitialized=true;_fld=_lst[0];_sbx.append(_fld);for (_i=1;_i<=_lst.length-1;_i++) {_fld=_lst[_i];_sbx.append(_delimiter).append(_fld);}return _sbx.toString();};_B.execqueryresult=function(_qry) {var _res,_obj1,_columns,_values,_vcnt,_vtot,_ctot,_ccnt,_row,_rec,_colname,_colvalu;_B._result.length=0;_B._rowcount=0;_B._lastposition=-1;_res=_B._dbsql["exec"](_qry);if (_res.length==1) {_obj1=_res[0];_columns=_obj1["columns"];_values=_obj1["values"];_B._rowcount=_values.length;_vcnt=0;_vtot=_values.length-1;_ctot=_columns.length-1;_ccnt=0;for (_vcnt=0;_vcnt<=_vtot;_vcnt++) {_row=_values[_vcnt];_rec={};for (_ccnt=0;_ccnt<=_ctot;_ccnt++) {_colname=_columns[_ccnt];_colname=_colname.toLowerCase();_colvalu=_row[_ccnt];_rec[_colname]=_colvalu;}_B._result.push(_rec);}}};_B.raiseerror=function(_task,_message) {_B.postmessage("ERROR","" + _task + " - " + _message + "",_B);};_B.fileexist=function(_fn) {var _error,_fetch,_fetchresponse,_prom,_bfo;_error={};_fetch={};_fetchresponse={};_prom=null;_bfo={};_bfo.method="HEAD";_prom = new Promise(function(resolve,reject) {_fetch=fetch(_fn,_bfo);_fetch.then(function(_fetchresponse) {resolve(_fetchresponse.ok);}).catch(function(_error) {reject(false);});});return _prom;};_B.clear_where=function() {_B._wherefield={};_B._ops.length=0;_B._orderbyl.length=0;_B._flds.length=0;_B._args.length=0;_B._types.length=0;};_B.add_field=function(_fld) {_B._flds.push(_fld);};_B.add_fields=function(_fields) {var _fld;for (var _fldindex=0;_fldindex<_fields.length;_fldindex++) {_fld=_fields[_fldindex];_B.add_field(_fld,_B);}};_B.add_where=function(_fld,_operator,_value) {_B._wherefield[_fld]=_value;_B._ops.push(_operator);};_B.add_order_by=function(_fld) {_B._orderbyl.push(_fld);};_B.setfield=function(_fldname,_fldvalue) {_B._record[_fldname]=_fldvalue;};_B.recordfrommap=function(_sm) {var _k,_v;_B._record={};var _kKeys = Object.keys(_sm);for (var _kindex=0;_kindex<_kKeys.length;_kindex++) {_k=_kKeys[_kindex];_v=_sm[_k];_B._record[_k]=_v;}};_B.firstrecord=function() {var _rec;_rec=_B._result[0];return _rec;};_B.nextrow=function() {var _realsize;_B._lastposition=_B._lastposition+1;_realsize=_B._rowcount-1;if (_B._lastposition>_realsize) {return false;} else {_B.setposition(_B._lastposition,_B);return true;}};_B.schemaclear=function() {_B._schema={};};_B.setrecord=function(_rec) {var _k,_v;var _kKeys = Object.keys(_rec);for (var _kindex=0;_kindex<_kKeys.length;_kindex++) {_k=_kKeys[_kindex];_v=_rec[_k];_B.setfield(_k,_v,_B);}};_B.preparerecord=function() {_B._record={};};_B.setposition=function(_pos) {if (_B._result.length>_pos) {_B._record=_B._result[_pos];_B._lastposition=_pos;} else {_B._lastposition=-1;_B._record={};}};_B.getposition=function() {return _B._lastposition;};_B.getint=function(_fld) {var _obj;_fld=_fld.toLowerCase();if (is.undefined(_B._record)) { return 0;}if ((_fld in _B._record)) {_obj=_B._record[_fld]===undefined? 0:_B._record[_fld];_obj=_B.cint(_obj,_B);return _obj;} else {return 0;}};_B.getlong=function(_fld) {return _B.getint(_fld,_B);};_B.getstring=function(_fld) {var _obj;_fld=_fld.toLowerCase();if (is.undefined(_B._record)) { return "";}if ((_fld in _B._record)) {_obj=_B._record[_fld]===undefined? "":_B._record[_fld];_obj=_B.cstr(_obj,_B);return _obj;} else {return "";}};_B.getboolean=function(_fld) {var _obj;_fld=_fld.toLowerCase();if (is.undefined(_B._record)) { return false;}if ((_fld in _B._record)) {_obj=_B._record[_fld]===undefined? false:_B._record[_fld];_obj=_B.cbool(_obj,_B);return _obj;} else {return false;}};_B.getdouble=function(_fld) {var _obj;_fld=_fld.toLowerCase();if ((_fld in _B._record)) {_obj=_B._record[_fld]===undefined? 0:_B._record[_fld];_obj=_B.cdbl(_obj,_B);return _obj;} else {return 0;}};_B.getrecord=function(_pos) {var _rec;_rec=_B._result[_pos];return _rec;};_B.movefirst=function() {_B.setposition(0,_B);};_B.movelast=function() {_B.setposition(_B._rowcount-1,_B);};_B.moveprevious=function() {_B._lastposition=_B._lastposition-1;if (_B._lastposition<0) {_B._lastposition=0;}_B.setposition(_B._lastposition,_B);};_B.movenext=function() {_B._lastposition=_B._lastposition+1;if (_B._lastposition>_B._rowcount) {_B._lastposition=_B._rowcount-1;}_B.setposition(_B._lastposition,_B);};_B.instr=function(_stext,_sfind) {return _stext.toLowerCase().indexOf(_sfind.toLowerCase());};_B.cdbl=function(_o) {var _out,_nvalue,_nout;_o=_B.val(_o,_B);_out=BANano_nf(BANano_r(_o, 2),0);_nvalue=_B.cstr(_out,_B);_nvalue=_nvalue.split(",").join(".");_nvalue=_B.val(_nvalue,_B);_nout=parseFloat(_nvalue);return _nout;};_B.cstr=function(_o) {if (is.null(_o) || is.undefined(_o)) {_o="";}if (_o=="null") { return "";}if (_o=="undefined") { return "";}return ""+_o;};_B.cbool=function(_v) {var _s;if (is.null(_v) || is.undefined(_v)) {_v=false;}if (typeof _v=="string" || typeof _v=="object") {_s=_v+"";_s=_s.toLowerCase();if (_s=="") { return false;}if (_s=="false") { return false;}if (_s=="true") { return true;}if (_s=="1") { return true;}if (_s=="y") { return true;}if (_s=="0") { return false;}if (_s=="n") { return false;}if (_s=="no") { return false;}if (_s=="yes") { return true;}}return _v;};_B.cint=function(_o) {_o=_B.val(_o,_B);return parseInt(_o);};_B.isnan=function(_obj) {var _res;_res=window["isNaN"](_obj);return _res;};_B.val=function(_value) {var _sout,_mout,_slen,_i;_value=_B.cstr(_value,_B);_value=_value.trim();if (_value=="") {_value="0";}if (_B.isnan(_value,_B)) {_value="0";}try {_sout="";_mout="";_slen=_value.length;_i=0;for (_i=0;_i<=_slen-1;_i++) {_mout=_value.charAt(_i);if (_B.instr("0123456789.-",_mout,_B)!=-1) {_sout=_sout+_mout;}}return _sout;} catch(err) {return _value;}};}var _BB = self;var _B = new banano_sithasodaisysqlite3filebrowsersw_sqlite3x;self.addEventListener('message', function(event) {var ret = {};var m = event.data.method.toLowerCase();if(typeof _B[m]==='function') {ret.error = null;if (event.data.params==null) {ret.value = _B[m]();} else {ret.value = _B[m](...event.data.params);}} else {ret.error = 'Method not found';}self.postMessage(ret);});